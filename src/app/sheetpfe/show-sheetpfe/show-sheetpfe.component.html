<div class="card" *ngIf="notFound ; else found">
  <div class="card-body">
    <img [src]="notFound" class="img_404">
  </div>
</div>
<ng-template #found>
  <div class="card" *ngIf="sheet && edit === false">
    <div class="card-body">
      <h4 class="card-title">Sheet PFE</h4>

      <div class="card card-inverse-info" *ngIf="user.role === 'Etudiant' && notify.length">
        <div class="card-body" *ngFor="let item of notify">
          <p> {{ item.title }} </p>
          <p> {{ item.note }} </p>
        </div>
      </div>

      <app-detail-sheetpfe *ngIf="user.role === 'Enseignant' && sheetModify" [sheet]="sheet" ></app-detail-sheetpfe>

    </div>

    <div class="card-body">
      <h4 class="card-title">Title</h4>
      <p class="card-description"> {{ sheet.title }} </p>
    </div>
    <div class="card-body">
      <h4 class="card-title">Description</h4>
      <p class="card-description">
        {{ sheet.description }}
      </p>
    </div>
    <div class="card-body">
      <h4 class="card-title">Problematic</h4>
      <p class="card-description">
        {{ sheet.problematic }}
      </p>
    </div>
    <div class="card-body">
      <h4 class="card-title">Features</h4>
      <p class="card-description">
        {{ sheet.features }}
      </p>
    </div>
    <div class="card-body">
      <h4 class="card-title">Categories</h4>
      <ul class="list-arrow">
        <li *ngFor="let categorie of sheet.categories"> {{ categorie.name }} </li>
      </ul>
    </div>
    <div class="card-body">
      <h4 class="card-title">Entreprise</h4>
      <p class="card-description">
        <a href="" class="text-info"> {{ sheet.entreprise?.nameEntreprise }} </a>
      </p>
      <p>{{ sheet.entreprise?.adresse }} {{ sheet.entreprise?.pays }}</p>
      <p><i class="fa fa-envelope-o"></i> {{ sheet.entreprise?.emailEntreprise }} </p>
      <p><i class="fa fa-phone"></i> {{ sheet.entreprise?.telEntreprise }} </p>

    </div>
    <div class="card-body" *ngIf="user.role != 'Etudiant'">
      <h4 class="card-title">Student</h4>
      <p class="card-description">
        <a href="" class="text-info"> {{ sheet.etudiant?.prenom }} {{ sheet.etudiant?.nom }} </a>
      </p>
      <p><i class="fa fa-envelope-o"></i> {{ sheet.etudiant?.email }} </p>
    </div>
    <div class="card-body" *ngIf="sheet.enseignantsheet?.length">
      <h4 class="card-title">Stuff</h4>
      <div class="card-body"  *ngFor="let item of sheet.enseignantsheet.slice().reverse()">
        <h4 class="card-title"> {{ item.type }}</h4>
        <p class="card-description">
          <a href="" class="text-info"> {{ item.enseignant.prenom }} {{ item.enseignant.nom }} </a>
        </p>
        <p><i class="fa fa-envelope-o"></i> {{ item.enseignant.email }} </p>
        <p *ngIf="sheet.noteEncadreur > -1 && item.type === 'ENCADREUR'">note : {{ sheet.noteEncadreur }}</p>
        <p *ngIf="sheet.noteRapporteur > -1  && item.type === 'RAPPORTEUR'">note : {{ sheet.noteRapporteur }}</p>
      </div>
    </div>
    <div class="card-body">
      <div class="card-info">
        <p *ngIf="(sheet.etat === 'DEFAULT' || sheet.etat === 'REFUSE') && user.role != 'DirecteurDesStages' &&  user.role != 'Enseignant';else validate ">The sheet PFE being <span class="text-warning"> checked</span></p>
        <ng-template #validate>
          <p *ngIf="(sheet.etat === 'PRE_VALIDATE' || sheet.etat === 'REQUEST') && user.role != 'Enseignant';else waiting ">The sheet PFE being <span class="text-warning"> validated</span></p>
        </ng-template>
        <ng-template #waiting>
          <p  *ngIf="exist_v === false && sheet.etat === 'ACCEPTED';else textecadreur">The sheet PFE waiting assignment of  <span class="text-warning"> validator .</span></p>
            <ng-template #textecadreur>
              <p  *ngIf="exist_e === false && sheet.etat === 'VALIDATE';else textrapporteur">The sheet PFE waiting assignment of <span class="text-warning"> encadreur .</span></p>
            </ng-template>
            <ng-template #textrapporteur>
              <p *ngIf="exist_r === false && sheet.etat === 'VALIDATE'">The sheet PFE waiting assignment of<span class="text-warning"> rapporteur .</span></p>
            </ng-template>
          <p *ngIf="(exist_e === true || exist_r === true) && sheet.etat === 'VALIDATE' && ( sheet.noteEncadreur < 0 || sheet.noteRapporteur < 0)">
              The sheet PFE waiting
              <span class="text-warning" *ngIf=" sheet.noteEncadreur < 0 && exist_e === true "> note encadreur </span>
              <span *ngIf=" sheet.noteEncadreur < 0 && sheet.noteRapporteur < 0"> and </span>
              <span class="text-warning" *ngIf="sheet.noteRapporteur < 0 && exist_r === true"> note rapporteur .</span>
          </p>
          <p *ngIf="sheet.noteEncadreur > -1 && sheet.noteRapporteur > -1">
            The sheet PFE waiting <span class="text-warning">planning .</span>
          </p>

        </ng-template>
        <p *ngIf="sheet.etat === 'REQUEST' && user.role === 'Enseignant'">Request has been sent : <span class="text-warning"> {{ sheet.note }}</span></p>

      </div>
      <div class="form-group"  *ngIf="user.role === 'Etudiant' && sheet.etat != 'PRE_VALIDATE' && exist_r === false">
        <button type="button" class="btn btn-primary mr-2" (click)="update()">Edit</button>
      </div>
      <div class="form-group"  *ngIf=" (user.role === 'Etudiant' || user.role === 'DirecteurDesStages') && exist_e ">
        <button type="button" class="btn btn-inverse-primary mr-2" (click)="update()">Export PDF</button>
      </div>
      <div class="form-group"  *ngIf="user.role === 'Enseignant' && sheet.etat === 'PRE_VALIDATE'">
        <button type="button" class="btn btn-primary mr-2" (click)="valid('accepted')" >Accepted</button>
        <button type="button" class="btn btn-primary mr-2" (click)="valid('request')">Request</button>
      </div>
      <div class="form-group"  *ngIf="user.role === 'Enseignant' && sheet.etat === 'VALIDATE'">
        <button type="button" class="btn btn-primary mr-2" (click)="note('encadreur')" *ngIf="verifEnseignant('ENCADREUR') && sheet.noteEncadreur < 0" >Note encadreur</button>
        <button type="button" class="btn btn-primary mr-2" (click)="note('rapporteur')" *ngIf="verifEnseignant('RAPPORTEUR') && sheet.noteRapporteur < 0">Note rapporteur</button>
      </div>
      <div class="form-group"  *ngIf="user.role === 'DirecteurDesStages' && sheet.etat === 'DEFAULT'">
        <button type="button" class="btn btn-primary mr-2" (click)="valid('accepted')">Accepted</button>
        <button type="button" class="btn btn-inverse-danger mr-2" (click)="valid('refuse')">Refuse</button>
      </div>
      <div class="form-group" *ngIf="user.role === 'ChefDeDepartement'">
        <button type="button" class="btn btn-inverse-success mr-2" (click)="updateEnseignant('encadreur')" *ngIf="exist_e === true && sheet.noteEncadreur < 0 ">Update encadreur</button>
        <button type="button" class="btn btn-inverse-success mr-2" (click)="updateEnseignant('rapporteur')" *ngIf="exist_r === true && sheet.noteRapporteur < 0">Update rapporteur</button>
        <button type="button" class="btn btn-primary mr-2" (click)="affect('validateur')" *ngIf="exist_v === false && sheet.etat === 'ACCEPTED';else btnencadreur">Affect Validator</button>
        <ng-template #btnencadreur>
          <button type="button" class="btn btn-primary mr-2" (click)="affect('encadreur')" *ngIf="exist_e === false && sheet.etat === 'VALIDATE';else btnrapporteur">Affect Encadreur</button>
        </ng-template>
        <ng-template #btnrapporteur>
          <button type="button" class="btn btn-primary mr-2" (click)="affect('rapporteur')" *ngIf="exist_r === false && sheet.etat === 'VALIDATE'">Affect Rapporteur</button>
        </ng-template>
      </div>
      <p class="text-primary cursor-pointer" *ngIf="user.role === 'ChefDeDepartement'" (click)="showDetails()"><u>show details</u></p>
    </div>
  </div>
  <app-add-sheetpfe *ngIf="user.role === 'Etudiant' && edit || !sheet" [sheet]="sheet" [edit]="edit" (hide)="hide($event)"></app-add-sheetpfe>
  <app-detail-sheetpfe *ngIf="details"></app-detail-sheetpfe>
</ng-template>



